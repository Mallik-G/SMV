<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" type="text/css" href="github.css">
</head>
<body>
<table class="nav-table">
    <tr>
        <td class="nav-left">&lArr;&nbsp;<a href="getting_started.html">Getting Started</a></td>
        <td class="nav-center"><a href="0_user_toc.html">Table Of Contents</a></td>
        <td class="nav-right"><a href="smv_intro.html">SMV Introduction</a>&nbsp;&rArr;</td>
    </tr>
</table>
<hr>

<article class="markdown-body">
<h1 id="getting-started-python">Getting Started Python</h1>
<h2 id="choose-a-python-binary-python2-python3-ipython-etc.">Choose a Python Binary (python2, python3, ipython etc.)</h2>
<p>SMV, and PySpark, supports both Python 2 and Python 3. By default, the first executable python found on the path, which can be found by <code>python --version</code>, is used to run python scripts. To change this to a specific python executable, set the environment variable <code>PYSPARK_PYTHON</code> for Python used on executor nodes, and the environment variable <code>PYSPARK_DRIVER_PYTHON</code> for Python used on the driver node.</p>
<p>In pyspark shell, the version of the Python binary used is printed after the Spark banner.</p>
<h2 id="create-an-smv-application">Create an SMV Application</h2>
<p>This step is identical to Scala. See <a href="getting_started.html">Getting Started</a></p>
<p>The <code>smv-init</code> script will create a <code>src/main/python</code> directory and copy the example python scripts. This directory is appended to the <code>PYTHONPATH</code> environment variable. Following Python convention, all subdirectories containing the special file <code>__init__.py</code>, which can be empty, are considered Python packages and are included on the search path to locate Python modules.</p>
<h2 id="build-smv-assembly-jar">Build SMV assembly jar</h2>
<p>Even if you are writing an SMV application in 100% Python, you still need to have the SMV Scala library in order to use its core functionality. Hence the necessity to run a build, which is not common in Python projects. In the future, this step may also be eliminated. But fortunately, in a pure Python project, you only need to do it once.</p>
<p>In the project root directory , if you use SBT for Scala compiling, simply run</p>
<pre class="shell"><code>$ sbt assembly</code></pre>
<p>If you use Maven, then run</p>
<pre class="shell"><code>$ mvn package</code></pre>
<h2 id="run-example-application">Run Example Application</h2>
<p>Python SMV applications can be run using the <code>smv-pyrun</code> script.</p>
<pre class="shell"><code>$ _SMV_HOME_/tools/smv-pyrun -m com.mycompany.myapp.stage1.employment.PythonEmploymentByStateCategory</code></pre>
<h3 id="publish-to-hive-table">Publish to Hive Table</h3>
<p>If the <code>--publish-hive</code> flag is specified, then the selected modules will be published/exported to a hive table. The have table name will be determined by the <code>tableName</code> method of the module. The selected module must also implement <code>SmvPyOutput</code>. For example, Given the module <code>X</code> in package <code>a.b.c</code> below:</p>
<pre class="sourceCode python"><code class="sourceCode python"><span class="kw">class</span> X(SmvPyModule, SmvPyOutput):
    <span class="co">&quot;&quot;&quot;python module&quot;&quot;&quot;</span>
    <span class="kw">def</span> tableName(<span class="ot">self</span>):
        <span class="kw">return</span> <span class="st">&quot;schema.foobar&quot;</span>
    <span class="kw">def</span> requiresDS(<span class="ot">self</span>): ...
    <span class="kw">def</span> run(<span class="ot">self</span>, i): ...</code></pre>
<p>Then running the following command will publish the result of module <code>X</code> to table <code>schema.foobar</code></p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">_SMV_HOME_/tools/smv-pyrun</span> --publish-hive -m a.b.c.X</code></pre>
<p><strong>Note:</strong> only python modules can be published to Hive tables currently due to upcoming internal restructure.</p>
<p>:information_source: Note: Python modules must be specified using the fully-qualified name on the cmdline, unlike Scala where unambiguous basenames can be used. Basename-only feature may be added in the future for Python. The fully qualified name for a Python module includes the file name (hence the <code>employment</code> part in the above example, because the module is defined in the file <code>employment.py</code>).</p>
<p>:soon: <code>-s stage</code></p>
<h2 id="interactive-shell">Interactive Shell</h2>
<p>Python SMV modules can be loaded in <code>smv-pyshell</code>.</p>
<pre class="shell"><code>$ _SMV_HOME/tools/smv-pyshell
...
Using Python version 3.4.0 (default, Jun 19 2015 14:20:21)
SparkContext available as sc, HiveContext available as sqlContext.
&gt;&gt;&gt; import smv
&gt;&gt;&gt; app = smv.SmvPy([&#39;-m&#39;, &#39;None&#39;], sqlContext)
&gt;&gt;&gt; r1 = app.runModule(&#39;com.mycompany.myapp.stage1.employment.PythonEmploymentByState&#39;)
&gt;&gt;&gt; r1.show()</code></pre>
<p>:soon: init files</p>
</article>
</body>
</html>
